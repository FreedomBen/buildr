<html>
  <head>
    <meta content='text/html;charset=UTF-8' http-equiv='Content-Type'>
    <title>buildr &mdash; Projects</title>
    <style type='text/css'>
      @import 'css/default.css';
      @import 'css/syntax.css';
    </style>
    <style media='print' type='text/css'>
      @import 'css/print.css';
    </style>
    <meta content='Official Buildr documentation from the people in the know' name='subject'>
    <link href='images/favicon.png' rel='shortcut icon'>
  </head>
  <body>
    <div id='wrap'>
      <div id='header'>
        <a href='http://buildr.apache.org/' title="Build like you code"><img alt='buildr' src='images/buildr.png'></a>
        <div class='tagline'>Build like you code</div>
      </div>
      <div id='pages'>
        <ol class='toc'>
          <li>Start Here
            <ol class="toc">
              <li><a href='index.html'>Welcome</a></li>
              <li><a href='quick_start.html'>Quick Start</a></li>
              <li><a href='installing.html'>Installing & Running</a></li>
              <li><a href='http://cwiki.apache.org/confluence/display/BUILDR/Index'>Community Wiki</a></li>
            </ol>
          </li>
          <li>Using Buildr
            <ol class="toc">
              <li><a href='buildr.pdf'>This Guide (PDF)</a></li>
              <li><a href='projects.html'>Projects</a></li>
              <li><a href='building.html'>Building</a></li>
              <li><a href='artifacts.html'>Artifacts</a></li>
              <li><a href='packaging.html'>Packaging</a></li>
              <li><a href='testing.html'>Testing</a></li>
              <li><a href='releasing.html'>Releasing</a></li>
              <li><a href='settings_profiles.html'>Settings/Profiles</a></li>
              <li><a href='languages.html'>Languages</a></li>
              <li><a href='more_stuff.html'>More Stuff</a></li>
              <li><a href='extending.html'>Extending Buildr</a></li>
              <li><a href='http://cwiki.apache.org/confluence/display/BUILDR/Buildr+HowTos'>How-Tos</a></li>
            </ol>
          </li>
          <li>Reference
            <ol class="toc">
              <li><a href='rdoc'>API</a></li>
              <li><a href='http://docs.rubyrake.org'>Rake</a></li>
              <li><a href='http://antwrap.rubyforge.org'>Antwrap</a></li>
              <li><a href='http://cwiki.apache.org/confluence/display/BUILDR/Common+Problems+and+Solutions'>Troubleshooting</a></li>
            </ol>
          </li>
          <li>Get Involved
            <ol class="toc">
              <li><a href='download.html'>Download</a></li>
              <li><a href='mailing_lists.html'>Mailing Lists</a></li>
              <li><a href='http://www.twitter.com/buildr'>Twitter</a></li>
              <li><a href='http://issues.apache.org/jira/browse/Buildr'>Issues/Bugs</a></li>
              <li><a href='https://builds.apache.org/view/A-F/view/Buildr'>CI Jobs</a></li>
              <li><a href='contributing.html'>Contributing</a></li>
            </ol>
          </li>
          <li>
            <form action='http://www.google.com/cse' id='searchbox_003673095760649043902:ogcgrzu0l2y'>
              <input name='cx' type='hidden' value='003673095760649043902:ogcgrzu0l2y'>
              <input name='cof' type='hidden' value='FORID:0'>
              <input name='q' size='20' type='text'>
              <input name='sa' type='submit' value='Search'>
              <img alt='Google Custom Search' src='http://www.google.com/coop/images/google_custom_search_smnar.gif'>
            </form>
          </li>
          <li>The Buildr Book
            <p><a href='http://www.amazon.com/Buildr/dp/1442160942/'><img src='images/1442160941-frontcover.jpg' style='width:120px'></a></p>
            <p>Based on the Buildr documentation, available from <a href='http://www.amazon.com/Buildr/dp/1442160942/'>Amazon</a> and
            <a href='http://www.createspace.com/3382199'>CreateSpace</a></p>
          </li>
        </ol>
      </div>
      <div id='content'>
        <h1 id='projects'>Projects</h1>
        <ol class="toc"><li><a href="#starting">Starting Out</a></li><li><a href="#dir_structure">The Directory Structure</a></li><li><a href="#naming">Naming And Finding Projects</a></li><li><a href="#tasks">Running Project Tasks</a></li><li><a href="#properties">Setting Project Properties</a></li><li><a href="#paths">Resolving Paths</a></li><li><a href="#defining">Defining The Project</a></li><li><a href="#your_own_tasks">Writing Your Own Tasks</a></li></ol>
        <h2 id="starting">Starting Out</h2>
<p>In Java, most projects are built the same way: compile source code, run test cases, package the code, release it.  Rinse, repeat.</p>
<p>Feed it a project definition, and Buildr will set up all these tasks for you. The only thing you need to do is specify the parts that are specific to your project, like the classpath dependencies, whether you&#8217;re packaging a <span class="caps">JAR</span> or a <span class="caps">WAR</span>, etc.</p>
<p>The remainder of this guide deals with what it takes to build a project.  But first, let&#8217;s pick up a sample project to work with.  We&#8217;ll call it <em>killer-app</em>:</p>
<div class="highlight"><pre><code class="ruby"><span class="nb">require</span> <span class="s2">&quot;buildr/openjpa&quot;</span>

<span class="kp">include</span> <span class="no">Buildr</span><span class="o">::</span><span class="no">OpenJPA</span>
 
<span class="no">VERSION_NUMBER</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
 
<span class="no">AXIS2</span> <span class="o">=</span> <span class="s1">&#39;org.apache.axis2:axis2:jar:1.2&#39;</span>
<span class="no">AXIOM</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="s1">&#39;axiom-api&#39;</span><span class="p">,</span> <span class="s1">&#39;axiom-impl&#39;</span><span class="p">,</span> <span class="s1">&#39;axiom-dom&#39;</span><span class="p">,</span>
  <span class="ss">:under</span><span class="o">=&gt;</span><span class="s1">&#39;org.apache.ws.commons.axiom&#39;</span><span class="p">,</span> <span class="ss">:version</span><span class="o">=&gt;</span><span class="s1">&#39;1.2.4&#39;</span><span class="p">)</span>
<span class="no">AXIS_OF_WS</span> <span class="o">=</span> <span class="o">[</span><span class="no">AXIOM</span><span class="p">,</span> <span class="no">AXIS2</span><span class="o">]</span>
<span class="no">OPENJPA</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;org.apache.openjpa:openjpa:jar:1.2.0&#39;</span><span class="p">,</span>
  <span class="s1">&#39;net.sourceforge.serp:serp:jar:1.12.0&#39;</span><span class="o">]</span>
 
<span class="n">repositories</span><span class="o">.</span><span class="n">remote</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;http://www.ibiblio.org/maven2/&#39;</span>
 
<span class="n">desc</span> <span class="s1">&#39;Code. Build. ??? Profit!&#39;</span>
<span class="n">define</span> <span class="s1">&#39;killer-app&#39;</span> <span class="k">do</span>
 
  <span class="n">project</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="no">VERSION_NUMBER</span>
  <span class="n">project</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;acme&#39;</span>
  <span class="n">manifest</span><span class="o">[</span><span class="s1">&#39;Copyright&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Acme Inc (C) 2007&#39;</span>
  <span class="n">compile</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;1.5&#39;</span>

  <span class="n">desc</span> <span class="s1">&#39;Abstract classes and interfaces&#39;</span>
  <span class="n">define</span> <span class="s1">&#39;teh-api&#39;</span> <span class="k">do</span>
    <span class="n">package</span> <span class="ss">:jar</span>
  <span class="k">end</span>

  <span class="n">desc</span> <span class="s1">&#39;All those implementation details&#39;</span>
  <span class="n">define</span> <span class="s1">&#39;teh-impl&#39;</span> <span class="k">do</span>
    <span class="n">compile</span><span class="o">.</span><span class="n">with</span> <span class="no">AXIS_OF_WS</span><span class="p">,</span> <span class="no">OPENJPA</span>
    <span class="n">compile</span> <span class="p">{</span> <span class="n">open_jpa_enhance</span> <span class="p">}</span>
    <span class="n">package</span> <span class="ss">:jar</span>
  <span class="k">end</span>

  <span class="n">desc</span> <span class="s1">&#39;What our users see&#39;</span>
  <span class="n">define</span> <span class="s1">&#39;la-web&#39;</span> <span class="k">do</span>
    <span class="nb">test</span><span class="o">.</span><span class="n">with</span> <span class="no">AXIS_OF_WS</span>
    <span class="n">package</span><span class="p">(</span><span class="ss">:war</span><span class="p">)</span><span class="o">.</span><span class="n">with</span> <span class="ss">:libs</span><span class="o">=&gt;</span><span class="n">projects</span><span class="p">(</span><span class="s1">&#39;teh-api&#39;</span><span class="p">,</span> <span class="s1">&#39;teh-impl&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">javadoc</span> <span class="n">projects</span>
  <span class="n">package</span> <span class="ss">:javadoc</span>

<span class="k">end</span>
</code></pre>
</div>
<p>A project definition requires four pieces of information: the project name, group identifier, version number and base directory.  The project name &#8230; do we need to explain why its necessary?  The group identifier and version number are used for packaging and deployment, we&#8217;ll talk more about that in the <a href="packaging.html">Packaging</a> section.  The base directory lets you find files inside the project.</p>
<p>Everything else depends on what that particular project is building.  And it all goes inside the project definition block, the piece of code that comes between <code>define &lt;name&gt; ..  do</code> and <code>end</code>.</p>
<h2 id="dir_structure">The Directory Structure</h2>
<p>Buildr follows a convention we picked from years of working with Apache projects.</p>
<p>Java projects are laid out so the source files are in the <code>src/main/java</code> directory and compile into the <code>target/classes</code> directory.  Resource files go in the <code>src/main/resources</code> directory, and copied over to <code>target/resources</code>. Likewise, tests come from <code>src/test/java</code> and <code>src/test/resources</code>, and end life in <code>target/test/classes</code> and <code>target/test/resources</code>, respectively.</p>
<p><span class="caps">WAR</span> packages pick up additional files from the aptly named <code>src/main/webapp</code>. And most stuff, including generated source files are parked under the <code>target</code> directory.  Test cases and such may generate reports in the, you guessed it, <code>reports</code> directory.</p>
<p>Other languages will use different directories, but following the same general conventions.  For example, Scala code compiles from the <code>src/main/scala</code> directory, RSpec tests are found in the <code>src/test/rspec</code> directory, and Flash will compile to <code>target/flash</code>.  Throughout this document we will show examples using mostly Java, but you can imagine how this pattern applies to other languages.</p>
<p>When projects grow big, you split them into smaller projects by nesting projects inside each other.  Each sub-project has a sub-directory under the parent project and follows the same internal directory structure.  You can, of course, change all of that to suite your needs, but if you follow these conventions, Buildr will figure all the paths for you.</p>
<p>Going back to the example above, the directory structure will look something like this:</p>
<p style="text-align:center;"><img src="images/project-structure.png" alt="" /></p>
<p>Notice the <code>buildfile</code> at the top.  That&#8217;s your project build script, the one Buildr runs.</p>
<p>When you run the <code>buildr</code> command, it picks up the <code>buildfile</code> (which here we&#8217;ll just call <em>Buildfile</em>) from the current directory, or if not there, from the closest parent directory.  So you can run <code>buildr</code> from any directory inside your project, and it will always pick up the same Buildfile.  That also happens to be the base directory for the top project.  If you have any sub-projects, Buildr assumes they reflect sub-directories under their parent.</p>
<p>And yes, you can have two top projects in the same Buildfile.  For example, you can use that to have one project that groups all the application modules (JARs, WARs, etc) and another project that groups all the distribution packages (binary, sources, javadocs).</p>
<p>When you start with a new project you won&#8217;t see the <code>target</code> or <code>reports</code> directories.  Buildr creates these when it needs to.  Just know that they&#8217;re there.</p>
<h2 id="naming">Naming And Finding Projects</h2>
<p>Each project has a given name, the first argument you pass when calling <code>define</code>.  The project name is just a string, but we advise to stay clear of colon (<code>:</code>) and slashes (<code>/</code> and <code>\</code>), which could conflict with other task and file names.  Also, avoid using common Buildr task names, don&#8217;t pick <code>compile</code>, <code>build</code> or any existing task name for your project name.</p>
<p>Since each project knows its parent project, child projects and siblings, you can reference them from within the project using just the given name.  In other cases, you&#8217;ll need to use the full name.  The full name is just <code>parent:child</code>. So if you wanted to refer to <em>teh-impl</em>, you could do so with either <code>project('killer-app:teh-impl')</code> or <code>project('killer-app').project('teh-impl')</code>.</p>
<p>The <code>project</code> method is convenient when you have a dependency from one project to another, e.g. using the other project in the classpath, or accessing one of its source files.  Call it with a project name and it will return that object or raise an error.  You can also call it with no arguments and it will return the project itself.  It&#8217;s syntactic sugar that&#8217;s useful when accessing project properties.</p>
<p>The <code>projects</code> method takes a list of names and returns a list of projects.  If you call it with no arguments on a project, it returns all its sub-projects.   If you call it with no argument in any other context, it returns all the projects defined so far.</p>
<p>Let&#8217;s illustrate this with a few examples:</p>
<div class="highlight"><pre><code class="ruby"><span class="nb">puts</span> <span class="n">projects</span><span class="o">.</span><span class="n">inspect</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="n">project</span><span class="p">(</span><span class="s2">&quot;killer-app&quot;</span><span class="p">),</span> <span class="n">project</span><span class="p">(</span><span class="s2">&quot;killer-app:teh-api&quot;</span><span class="p">)</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="o">]</span>

<span class="nb">puts</span> <span class="n">project</span><span class="p">(</span><span class="s1">&#39;killer-app&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">projects</span><span class="o">.</span><span class="n">inspect</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="n">project</span><span class="p">(</span><span class="s2">&quot;killer-app:teh-api&quot;</span><span class="p">),</span> <span class="n">project</span><span class="p">(</span><span class="s2">&quot;killer-app:teh-impl&quot;</span><span class="p">)</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="o">]</span>

<span class="nb">puts</span> <span class="n">project</span><span class="p">(</span><span class="s1">&#39;teh-api&#39;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="no">No</span> <span class="n">such</span> <span class="n">project</span> <span class="n">teh</span><span class="o">-</span><span class="n">api</span>

<span class="nb">puts</span> <span class="n">project</span><span class="p">(</span><span class="s1">&#39;killer-app:teh-api&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">inspect</span>
<span class="o">=&gt;</span> <span class="n">project</span><span class="p">(</span><span class="s2">&quot;killer-app:teh-api&quot;</span><span class="p">)</span>

<span class="nb">puts</span> <span class="n">project</span><span class="p">(</span><span class="s1">&#39;killer-app&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="s1">&#39;teh-api&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">inspect</span>
<span class="o">=&gt;</span> <span class="n">project</span><span class="p">(</span><span class="s2">&quot;killer-app:teh-api&quot;</span><span class="p">)</span>
</code></pre>
</div>
<p>To see a list of all projects defined in your Buildfile run <code>buildr help:projects</code>.</p>
<h2 id="tasks">Running Project Tasks</h2>
<p>Most times, you run tasks like <code>build</code> or <code>package</code> that operate on the current project and recursively on its sub-projects.  The &#8220;current project&#8221; is the one that uses the current working directory.  So if you&#8217;re in the <code>la-web/src</code> directory looking at source files, <em>la-web</em> is the current project.  For example:</p>
<div class="highlight"><pre><code class="sh"><span class="c"># build killer-app and all its sub-projects</span>
<span class="nv">$ </span>buildr build

<span class="c"># switch to and test only teh-impl</span>
<span class="nv">$ </span><span class="nb">cd </span>teh-impl
<span class="nv">$ </span>buildr <span class="nb">test</span>

<span class="c"># switch to and package only la-web</span>
<span class="nv">$ </span><span class="nb">cd</span> ../la-web
<span class="nv">$ </span>buildr package
</code></pre>
</div>
<p>You can use the project&#8217;s full name to invoke one of its tasks directly, and it doesn&#8217;t matter which directory you&#8217;re in.  For example:</p>
<div class="highlight"><pre><code class="sh"><span class="c"># build killer-app and all its sub-projects</span>
<span class="nv">$ </span>buildr killer-app:build

<span class="c"># test only teh-impl</span>
<span class="nv">$ </span>buildr killer-app:teh-impl:test

<span class="c"># package only la-web</span>
<span class="nv">$ </span>buildr killer-app:la-web:package
</code></pre>
</div>
<p>Buildr provides the following tasks that you can run on the current project, or on a specific project by prefixing them with the project&#8217;s full name:</p>
<div class="highlight"><pre><code class="text">clean     # Clean files generated during a build
compile   # Compile all projects
build     # Build the project
upload    # Upload packages created by the project
install   # Install packages created by the project
javadoc   # Create the Javadocs for this project
package   # Create packages
test      # Run all test cases
uninstall # Remove previously installed packages
</code></pre>
</div>
<p>To see a list of all the tasks provided by Buildr run <code>buildr help:tasks</code>.</p>
<h2 id="properties">Setting Project Properties</h2>
<p>We mentioned the group identifier, version number and base directory.  These are project properties.  There are a few more properties we&#8217;ll cover later on.</p>
<p>There are two ways to set project properties.  You can pass them as a hash when you call <code>define</code>, or use accessors to set them on the project directly.  For example:</p>
<div class="highlight"><pre><code class="ruby"><span class="n">define</span> <span class="s1">&#39;silly&#39;</span><span class="p">,</span> <span class="ss">:version</span><span class="o">=&gt;</span><span class="s1">&#39;1.0&#39;</span> <span class="k">do</span>
  <span class="n">project</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;acme&#39;</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">project</span><span class="p">(</span><span class="s1">&#39;silly&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">version</span>
<span class="o">=&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span>
<span class="nb">puts</span> <span class="n">project</span><span class="p">(</span><span class="s1">&#39;silly&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span>
<span class="o">=&gt;</span> <span class="n">acme</span>
</code></pre>
</div>
<p>Project properties are inherited.  You can specify them once in the parent project, and they&#8217;ll have the same value in all its sub-projects.  In the example, we only specify the version number once, for use in all sub-projects.</p>
<h2 id="paths">Resolving Paths</h2>
<p>You can run <code>buildr</code> from any directory in your project.  To keep tasks consistent and happy, it switches over to the Buildfile directory and executes all the tasks from there, before returning back to your working directory. Your tasks can all rely on relative paths that start from the same directory as the Buildfile.</p>
<p>But in practice, you&#8217;ll want to use the <code>path_to</code> method.  This method calculates a path relative to the project, a better way if you ever need to refactor your code, say turn a ad hoc task into a function you reuse.</p>
<p>The <code>path_to</code> method takes an array of strings and concatenates them into a path.  Absolute paths are returned as they are, relative paths are expanded relative to the project&#8217;s base directory.  Slashes, if you don&#8217;t already know, work very well on both Windows, Linux and OS X.  And as a shortcut, you can use <code>_</code>.</p>
<p>For example:</p>
<div class="highlight"><pre><code class="ruby"><span class="c1"># Relative to the current project</span>
<span class="n">path_to</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="s1">&#39;java&#39;</span><span class="p">)</span>

<span class="c1"># the same using symbols</span>
<span class="n">path_to</span><span class="p">(</span><span class="ss">:src</span><span class="p">,</span> <span class="ss">:main</span><span class="p">,</span> <span class="ss">:java</span><span class="p">)</span>

<span class="c1"># Exactly the same thing</span>
<span class="n">_</span><span class="p">(</span><span class="s1">&#39;src/main/java&#39;</span><span class="p">)</span>

<span class="c1"># Relative to the teh-impl project</span>
<span class="n">project</span><span class="p">(</span><span class="s1">&#39;teh-impl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;src/main/java&#39;</span><span class="p">)</span>
</code></pre>
</div>
<h2 id="defining">Defining The Project</h2>
<p>The project definition itself gives you a lot of pre-canned tasks to start with, but that&#8217;s not enough to build a project.  You need to specify what gets built and how, which dependencies to use, the packages you want to create and so forth.  You can configure existing tasks, extend them to do additional work, and create new tasks.  All that magic happens inside the project definition block.</p>
<p>Since the project definition executes each time you run Buildr, you don&#8217;t want to perform any work directly inside the project definition block.  Rather, you want to use it to specify how different build task work when you invoke them. Here&#8217;s an example to illustrate the point:</p>
<div class="highlight"><pre><code class="ruby"><span class="n">define</span> <span class="s1">&#39;silly&#39;</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s1">&#39;Running buildr&#39;</span>

  <span class="n">build</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s1">&#39;Building silly&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Each time you run Buildr, it will execute the project definition and print out &#8220;Running buildr&#8221;.  We also extend the <code>build</code> task, and whenever we run it, it will print &#8220;Building silly&#8221;.  Incidentally, <code>build</code> is the default task, so if you run Buildr with no arguments, it will print both messages while executing the build.  If you run Buildr with a different task, say <code>clean</code>, it will only print the first message.</p>
<p>The <code>define</code> method gathers the project definition, but does not execute it immediately.  It executes the project definition the first time you reference that project, directly or indirectly, for example, by calling <code>project</code> with that project&#8217;s name, or calling <code>projects</code> to return a list of all projects. Executing a project definition will also execute all its sub-projects&#8217; definitions.  And, of course, all project definitions are executed once the Buildfile loads, so Buildr can determine how to execute each of the build tasks.</p>
<p>If this sounds a bit complex, don&#8217;t worry.  In reality, it does the right thing.  A simple rule to remember is that each project definition is executed before you need it, lazy evaluation of sort.  The reason we do that?  So you can write projects that depend on each other without worrying about their order.</p>
<p>In our example, the <em>la-web</em> project depends on packages created by the <em>teh-api</em> and <em>teh-impl</em> projects, the later requiring <em>teh-api</em> to compile. That example is simple enough that we ended up specifying the projects in order of dependency.  But you don&#8217;t always want to do that.  For large projects, you may want to group sub-projects by logical units, or sort them alphabetically for easier editing.</p>
<p>One project can reference another ahead of its definition.  If Buildr detects a cyclic dependency, it will let you know.</p>
<p>In this example we define one project in terms of another, using the same dependencies, so we only need to specify them once:</p>
<div class="highlight"><pre><code class="ruby"><span class="n">define</span> <span class="s1">&#39;bar&#39;</span> <span class="k">do</span>
  <span class="n">compile</span><span class="o">.</span><span class="n">with</span> <span class="n">project</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compile</span><span class="o">.</span><span class="n">dependencies</span>
<span class="k">end</span>

<span class="n">define</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">compile</span><span class="o">.</span><span class="n">with</span> <span class="o">.</span><span class="n">.lots</span> <span class="n">of</span> <span class="n">stuff</span><span class="o">.</span><span class="n">.</span>
<span class="k">end</span>
</code></pre>
</div>
<p>One last thing to remember.  Actually three, but they all go hand in hand.</p>
<p><strong>Self is project</strong> Each of these project definition blocks executes in the context of that project, just as if it was a method defined on the project.  So when you call the <code>compile</code> method, you&#8217;re essentially calling that method on the current project: <code>compile</code>, <code>self.compile</code> and <code>project.compile</code> are all the same.</p>
<p><strong>Blocks are closures</strong> The project definition is also a closure, which can reference variables from enclosing scopes.  You can use that, for example, to define constants, variables and even functions in your Buildfile, and reference them from your project definition.  As you&#8217;ll see later on, in the <a href="artifacts.html">Artifacts</a> section, it will save you a lot of work.</p>
<p><strong>Projects are namespaces</strong> While executing the project definition, Buildr switches the namespace to the project name.  If you define the task &#8220;do-this&#8221; inside the <em>teh-impl</em> project, the actual task name is &#8220;killer-app:teh-impl:do-this&#8221;.  Likewise, the <code>compile</code> task is actually &#8220;killer-app:teh-impl:compile&#8221;.</p>
<p>From outside the project you can reference a task by its full name, either <code>task('foo:do')</code> or <code>project('foo').task('do')</code>.  If you need to reference a task defined outside the project from within the project, prefix it with &#8220;rake:&#8221;, for example, <code>task('rake:globally-defined')</code>.</p>
<h2 id="your_own_tasks">Writing Your Own Tasks</h2>
<p>Of all the features Buildr provide, it doesn&#8217;t have a task for making coffee. Yet.  If you need to write your own tasks, you get all the power of Rake: you can use regular tasks, file tasks, task rules and even write your own custom task classes.  Check out the <a href="http://docs.rubyrake.org/">Rake documentation</a> for more information.</p>
<p>We mentioned projects as namespaces before.  When you call <code>task</code> on a project, it finds or defines the task using the project namespace.  So given a project object, <code>task('do-this')</code> will return it&#8217;s &#8220;do-this&#8221; task.  If you lookup the source code for the <code>compile</code> method, you&#8217;ll find that it&#8217;s little more than a shortcut for <code>task('compile')</code>.</p>
<p>Another shortcut is the <code>file</code> method.  When you call <code>file</code> on a project, Buildr uses the <code>path_to</code> method to expand relative paths using the project&#8217;s base directory.  If you call <code>file('src')</code> on <em>teh-impl</em>, it will return you a file task that points at the <code>teh-impl/src</code> directory.</p>
<p>In the current implementation projects are also created as tasks, although you don&#8217;t invoke these tasks directly.  That&#8217;s the reason for not using a project name that conflicts with an existing task name.  If you do that, you&#8217;ll find quick enough, as the task will execute each time you run Buildr.</p>
<p>So now that you know everything about projects and tasks, let&#8217;s go and <a href="building.html">build some code</a>.</p>
      </div>
      <div id='footer'>Copyright &copy; 2007-2010 The Apache Software Foundation</div>
    </div>
  </body>
</html>

<html>
  <head>
    <meta content='text/html;charset=UTF-8' http-equiv='Content-Type'>
    <title>buildr &mdash; Settings/Profiles</title>
    <style type='text/css'>
      @import 'css/default.css';
      @import 'css/syntax.css';
    </style>
    <style media='print' type='text/css'>
      @import 'css/print.css';
    </style>
    <meta content='Official Buildr documentation from the people in the know' name='subject'>
    <link href='images/favicon.png' rel='shortcut icon'>
  </head>
  <body>
    <div id='wrap'>
      <div id='header'>
        <a href='http://buildr.apache.org/' title="Build like you code"><img alt='buildr' src='images/buildr.png'></a>
        <div class='tagline'>Build like you code</div>
      </div>
      <div id='pages'>
        <ol class='toc'>
          <li>Start Here
            <ol class="toc">
              <li><a href='index.html'>Welcome</a></li>
              <li><a href='quick_start.html'>Quick Start</a></li>
              <li><a href='installing.html'>Installing & Running</a></li>
              <li><a href='http://cwiki.apache.org/confluence/display/BUILDR/Index'>Community Wiki</a></li>
            </ol>
          </li>
          <li>Using Buildr
            <ol class="toc">
              <li><a href='buildr.pdf'>This Guide (PDF)</a></li>
              <li><a href='projects.html'>Projects</a></li>
              <li><a href='building.html'>Building</a></li>
              <li><a href='artifacts.html'>Artifacts</a></li>
              <li><a href='packaging.html'>Packaging</a></li>
              <li><a href='testing.html'>Testing</a></li>
              <li><a href='releasing.html'>Releasing</a></li>
              <li><a href='settings_profiles.html'>Settings/Profiles</a></li>
              <li><a href='languages.html'>Languages</a></li>
              <li><a href='more_stuff.html'>More Stuff</a></li>
              <li><a href='extending.html'>Extending Buildr</a></li>
              <li><a href='http://cwiki.apache.org/confluence/display/BUILDR/Buildr+HowTos'>How-Tos</a></li>
            </ol>
          </li>
          <li>Reference
            <ol class="toc">
              <li><a href='rdoc'>API</a></li>
              <li><a href='http://docs.rubyrake.org'>Rake</a></li>
              <li><a href='http://antwrap.rubyforge.org'>Antwrap</a></li>
              <li><a href='http://cwiki.apache.org/confluence/display/BUILDR/Common+Problems+and+Solutions'>Troubleshooting</a></li>
            </ol>
          </li>
          <li>Get Involved
            <ol class="toc">
              <li><a href='download.html'>Download</a></li>
              <li><a href='mailing_lists.html'>Mailing Lists</a></li>
              <li><a href='http://www.twitter.com/buildr'>Twitter</a></li>
              <li><a href='http://issues.apache.org/jira/browse/Buildr'>Issues/Bugs</a></li>
              <li><a href='https://builds.apache.org/view/A-F/view/Buildr'>CI Jobs</a></li>
              <li><a href='contributing.html'>Contributing</a></li>
            </ol>
          </li>
          <li>
            <form action='http://www.google.com/cse' id='searchbox_003673095760649043902:ogcgrzu0l2y'>
              <input name='cx' type='hidden' value='003673095760649043902:ogcgrzu0l2y'>
              <input name='cof' type='hidden' value='FORID:0'>
              <input name='q' size='20' type='text'>
              <input name='sa' type='submit' value='Search'>
              <img alt='Google Custom Search' src='http://www.google.com/coop/images/google_custom_search_smnar.gif'>
            </form>
          </li>
          <li>The Buildr Book
            <p><a href='http://www.amazon.com/Buildr/dp/1442160942/'><img src='images/1442160941-frontcover.jpg' style='width:120px'></a></p>
            <p>Based on the Buildr documentation, available from <a href='http://www.amazon.com/Buildr/dp/1442160942/'>Amazon</a> and
            <a href='http://www.createspace.com/3382199'>CreateSpace</a></p>
          </li>
        </ol>
      </div>
      <div id='content'>
        <h1 id='settings/profiles'>Settings/Profiles</h1>
        <ol class="toc"><li><a href="#env_vars">Environment Variables</a></li><li><a href="#personal">Personal Settings</a></li><li><a href="#build">Build Settings</a></li><li><a href="#variable">Non constant settings</a></li><li><a href="#environments">Environments</a></li><li><a href="#profiles">Profiles</a></li></ol>
        <h2 id="env_vars">Environment Variables</h2>
<p>Buildr uses several environment variables that help you control how it works. Some environment variables you will only set once or change infrequently.  You can set these in your profile, OS settings or any tool you use to launch Buildr (e.g. continuous integration).</p>
<p>For example:</p>
<div class="highlight"><pre><code class="sh"><span class="nv">$ </span><span class="nb">export </span><span class="nv">HTTP_PROXY</span><span class="o">=</span>http://myproxy:8080
</code></pre>
</div>
<p>There are other environment variables you will want to set when running Buildr, for example, to do a full build without running the tests:</p>
<div class="highlight"><pre><code class="sh"><span class="nv">$ </span>buildr <span class="nb">test</span><span class="o">=</span>no
</code></pre>
</div>
<p>For convenience, the environment variables <code>TEST</code> and <code>DEBUG</code> are case insensitive, you can use either <code>test=no</code> or <code>TEST=no</code>. Any other environment variable names are case sensitive.</p>
<p>You can also set environment variables from within your Buildfile.  For example, if you discover that building your project requires gobs of <span class="caps">JVM</span> heap space, and you want all other team members to run with the same settings:</p>
<div class="highlight"><pre><code class="ruby"><span class="c1"># This project builds a lot of code.</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;JAVA_OPTS&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;-Xms1g -Xmx1g&#39;</span>
</code></pre>
</div>
<p>Make sure to set any environment variables at the very top of the Buildfile, above any Ruby statement (even <code>require</code>).</p>
<p class="tip">Using <code>||=</code> sets the environment variable, if not already set, so it&#8217;s still possible for other developers to override this environment variable without modifying the Buildfile.</p>
<p>Buildr supports the following environment variables:</p>
<table>
	<tr>
		<th>Variable    </th>
		<th>Description </th>
	</tr>
	<tr>
		<td> <code>BUILDR_ENV</code>  </td>
		<td> Environment name (development, production, test, etc). Another way to set this is using the <code>-e</code> command line option. </td>
	</tr>
	<tr>
		<td> <code>DEBUG</code>       </td>
		<td> Set to <code>no/off</code> if you want Buildr to compile without debugging information (default when running the <code>release</code> task, see <a href="building.html#compiling">Compiling</a>). </td>
	</tr>
	<tr>
		<td> <code>HOME</code>        </td>
		<td> Your home directory. </td>
	</tr>
	<tr>
		<td> <code>HTTP_PROXY</code>  </td>
		<td> <span class="caps">URL</span> for <span class="caps">HTTP</span> proxy server (see <a href="artifacts.html#repositories">Specifying Repositories</a>). </td>
	</tr>
	<tr>
		<td> <code>HTTPS_PROXY</code> </td>
		<td> <span class="caps">URL</span> for <span class="caps">HTTPS</span> proxy server (see <a href="artifacts.html#repositories">Specifying Repositories</a>). </td>
	</tr>
	<tr>
		<td> <code>IGNORE_BUILDFILE</code> </td>
		<td> Set to &#8220;true&#8221; or &#8220;yes&#8221; to ignore changes in Buildfile or its dependencies when running tests. </td>
	</tr>
	<tr>
		<td> <code>JAVA_HOME</code>   </td>
		<td> Points to your <span class="caps">JDK</span>, required when using Java and Ant. </td>
	</tr>
	<tr>
		<td> <code>JAVA_OPTS</code>   </td>
		<td> Command line options to pass to the <span class="caps">JDK</span> (e.g. <code>'-Xms1g'</code>). </td>
	</tr>
	<tr>
		<td> <code>M2_REPO</code>     </td>
		<td> Location of the Maven2 local repository.  Defaults to the <code>.m2</code> directory in your home directory (<code>ENV['HOME']</code>). </td>
	</tr>
	<tr>
		<td> <code>NO_PROXY</code>    </td>
		<td> Comma separated list of hosts and domain that should not be proxied (see <a href="artifacts.html#repositories">Specifying Repositories</a>).  </td>
	</tr>
	<tr>
		<td> <code>TEST</code>        </td>
		<td> Set to <code>no/off</code> to tell Buildr to skip tests, or <code>all</code> to tell Buildr to run all tests and ignore failures (see <a href="testing.html#running">Running Tests</a>). </td>
	</tr>
	<tr>
		<td> <code>USER</code>        </td>
		<td> Tasks that need your user name, for example to log to remote servers, will use this environment variable. </td>
	</tr>
</table>
<p class="note">Buildr does not check any of the arguments in <code>JAVA_OPTS</code>.  A common mistake is to pass an option like <code>mx512mb</code>, where it should be <code>Xmx512mb</code>. Make sure to double check <code>JAVA_OPTS</code>.</p>
<p>Some extensions may use additional environment variables, and of course, you can always add your own.  This example uses two environment variables for specifying the username and password:</p>
<div class="highlight"><pre><code class="ruby"><span class="n">repositories</span><span class="o">.</span><span class="n">release_to</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;USERNAME&#39;</span><span class="o">]</span>
<span class="n">repositories</span><span class="o">.</span><span class="n">release_to</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PASSWORD&#39;</span><span class="o">]</span>
</code></pre>
</div>
<h2 id="personal">Personal Settings</h2>
<p>Some things clearly do not belong in the Buildfile.  For example, the username and password you use to upload releases.  If you&#8217;re working in a team or on an open source project, you&#8217;d want to keep these in a separate place.</p>
<p>You may want to use personal settings for picking up a different location for the local repository, or use a different set of preferred remote repositories, and so forth.</p>
<p>The prefered way to store personal settings is to create a <code>.buildr/settings.yaml</code> file under your home directory. Settings stored there will be applied the same across all builds.</p>
<p>Here&#8217;s an example <code>settings.yaml</code>:</p>
<div class="highlight"><pre><code class="yaml"><span class="c1"># The repositories hash is read automatically by buildr.</span>
<span class="l-Scalar-Plain">repositories</span><span class="p-Indicator">:</span>

  <span class="c1"># customize user local maven2 repository location</span>
  <span class="l-Scalar-Plain">local</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">some/path/to/my_repo</span>

  <span class="c1"># prefer the local or nearest mirrors</span>
  <span class="l-Scalar-Plain">remote</span><span class="p-Indicator">:</span>
   <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">https://intra.net/maven2</span>
   <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">http://example.com</span>

  <span class="l-Scalar-Plain">release_to</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://intra.net/maven2</span>
    <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">john</span>
    <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">secret</span>

<span class="c1"># You can place settings of your own, and reference them</span>
<span class="c1"># on buildfiles.</span>
<span class="l-Scalar-Plain">im</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">server</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">jabber.company.com</span>
  <span class="l-Scalar-Plain">usr</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">notifier@company-jabber.com</span>
  <span class="l-Scalar-Plain">pwd</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">secret</span>
</code></pre>
</div>
<p>Later your buildfile or addons can reference user preferences using the  hash returned by the <code>Buildr.settings.user</code> accessor.</p>
<div class="highlight"><pre><code class="ruby"><span class="n">task</span> <span class="s1">&#39;release-notification&#39;</span> <span class="k">do</span>
 <span class="n">usr</span><span class="p">,</span> <span class="n">pwd</span><span class="p">,</span> <span class="n">server</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">user</span><span class="o">[</span><span class="s1">&#39;im&#39;</span><span class="o">].</span><span class="n">values_at</span><span class="p">(</span><span class="s1">&#39;usr&#39;</span><span class="p">,</span> <span class="s1">&#39;pwd&#39;</span><span class="p">,</span> <span class="s1">&#39;server&#39;</span><span class="p">)</span>
 <span class="n">jabber</span> <span class="o">=</span> <span class="no">JabberAPI</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">usr</span><span class="p">,</span> <span class="n">pwd</span><span class="p">)</span>
 <span class="n">jabber</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;We are pleased to announce the last stable version </span><span class="si">#{</span><span class="no">VERSION</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>
<h2 id="build">Build Settings</h2>
<p>Build settings are local to the project being built, and are placed in the <code>build.yaml</code> file located in the same directory that the <code>buildfile</code>. Normally this file would be managed by the project revision control system, so settings here are shared between developers.</p>
<p>They help keep the buildfile and build.yaml file simple and readable, working to the advantages of each one.  Example for build settings are gems, repositories and artifacts used by that build.</p>
<div class="highlight"><pre><code class="yaml"><span class="c1"># This project requires the following ruby gems, buildr addons</span>
<span class="l-Scalar-Plain">gems</span><span class="p-Indicator">:</span>
  <span class="c1"># Suppose we want to notify developers when testcases fail.</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">buildr-twitter-notifier-addon &gt;=1</span>
  <span class="c1"># we test with ruby mock objects</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mocha</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ci_reporter</span>

<span class="c1"># The artifact declarations will be automatically loaded by buildr, so that</span>
<span class="c1"># you can reference artifacts by name (a ruby-symbol) on your buildfile.</span>
<span class="l-Scalar-Plain">artifacts</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">spring</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org.springframework:spring:jar:2.0</span>
  <span class="l-Scalar-Plain">log4j</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">log4j:log4j:jar:1.0</span>
  <span class="l-Scalar-Plain">j2ee</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">geronimo-spec:geronimo-spec-j2ee:jar:1.4-rc4</span>

<span class="c1"># Of course project settings can be defined here</span>
<span class="l-Scalar-Plain">twitter</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">notify</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">test_failure</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">unless-modified</span>
    <span class="l-Scalar-Plain">compile_failure</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">never</span>
  <span class="l-Scalar-Plain">developers</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">joe</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">jane</span>

<span class="l-Scalar-Plain">jira</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">uri</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://jira.corp.org</span>
</code></pre>
</div>
<p>When buildr is loaded, required ruby gems will be installed if needed, thus adding features like the imaginary twitter notifier addon.</p>
<p>Artifacts defined on <code>build.yaml</code> can be referenced on your buildfile by supplying the ruby symbol to the <code>Buildr.artifact</code> and <code>Buildr.artifacts</code> methods.  The <code>compile.with</code>, <code>test.with</code> methods can also be given these names.</p>
<div class="highlight"><pre><code class="ruby"><span class="n">define</span> <span class="s1">&#39;my_project&#39;</span> <span class="k">do</span>
  <span class="n">compile</span><span class="o">.</span><span class="n">with</span> <span class="n">artifacts</span><span class="p">(</span><span class="ss">:log4j</span><span class="p">,</span> <span class="ss">:j2ee</span><span class="p">)</span>
  <span class="nb">test</span><span class="o">.</span><span class="n">with</span> <span class="ss">:spring</span><span class="p">,</span> <span class="ss">:j2ee</span>
<span class="k">end</span>
</code></pre>
</div>
<p>Build settings can be retreived using the <code>Buildr.settings.build</code> accessor.</p>
<div class="highlight"><pre><code class="ruby"> <span class="n">task</span> <span class="s1">&#39;create_patch&#39;</span> <span class="k">do</span>
   <span class="n">patch</span> <span class="o">=</span> <span class="no">Git</span><span class="o">.</span><span class="n">create_patch</span> <span class="ss">:interactive</span> <span class="o">=&gt;</span> <span class="kp">true</span>
   <span class="k">if</span> <span class="n">patch</span> <span class="o">&amp;&amp;</span> <span class="n">agree</span><span class="p">(</span><span class="s2">&quot;Would you like to request inclusion of </span><span class="si">#{</span><span class="n">patch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
     <span class="n">jira</span> <span class="o">=</span> <span class="no">Jira</span><span class="o">.</span><span class="n">new</span><span class="p">(</span> <span class="no">Buildr</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">build</span><span class="o">[</span><span class="s1">&#39;jira&#39;</span><span class="o">][</span><span class="s1">&#39;uri&#39;</span><span class="o">]</span> <span class="p">)</span>  <span class="c1"># submit a patch</span>
     <span class="n">jira</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:improvement</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span> <span class="ss">:attachment</span> <span class="o">=&gt;</span> <span class="n">patch</span><span class="o">.</span><span class="n">blob</span><span class="p">)</span>
   <span class="k">end</span>
 <span class="k">end</span>
</code></pre>
</div>
<h2 id="variable">Non constant settings</h2>
<p>Before loading the Buildfile, Buildr will attempt to load two other files: the <code>buildr.rb</code> file in the <code>.buildr</code> directory under your home directory, followed by the <code>_buildr.rb</code> (or <code>.buildr.rb</code>) file it finds in the build directory.</p>
<p>The loading order allows you to place global settings that affect all your builds in your <code>buildr.rb</code>, but also over-ride those with settings for a given project.</p>
<p>Here&#8217;s an example <code>buildr.rb</code>:</p>
<div class="highlight"><pre><code class="ruby"><span class="c1"># Only I should know that</span>
<span class="n">repositories</span><span class="o">.</span><span class="n">release_to</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;assaf&#39;</span>
<span class="n">repositories</span><span class="o">.</span><span class="n">release_to</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;supersecret&#39;</span>
<span class="c1"># Search here first, it&#39;s faster</span>
<span class="n">repositories</span><span class="o">.</span><span class="n">remote</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;http://inside-the-firewall&#39;</span>
</code></pre>
</div>
<p class="note">Buildr 1.3 and earlier used the file <code>buildr.rb</code> directly in your home directory.  Starting with version 1.4, Buildr loads <code>buildr.rb</code> from the <code>.buildr</code> directory under your home directory in preference.  If you use Buildr 1.3 and earlier and don&#8217;t want to duplicate your settings, you can move you existing <code>buildr.rb</code> under the <code>.buildr</code> directory and create a new <code>buildr.rb</code> in your home directory containing:</p>
<div class="highlight"><pre><code class="ruby"><span class="c1"># Backward compatibility:  Buildr 1.4+ uses $HOME/.buildr/buildr.rb</span>
<span class="nb">load</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;buildr.rb&#39;</span><span class="p">,</span> <span class="no">Buildr</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">home_dir</span><span class="p">)</span>
</code></pre>
</div>
<h2 id="environments">Environments</h2>
<p>One common use case is adapting the build to different environments.  For example, to compile code with debugging information during development and testing, but strip it for production.  Another example is using different databases for development, testing and production, or running services at different URLs.</p>
<p>So let&#8217;s start by talking about the build environment.  Buildr has a global attributes that indicates which environment it&#8217;s running in, accessible from the <code>environment</code> method.  You can set the current build environment in one of two ways.  Using the <code>-e/--environment</code> command line option:</p>
<div class="highlight"><pre><code class="sh"><span class="nv">$ </span>buildr -e <span class="nb">test</span>
<span class="o">(</span>in /home/john/project, <span class="nb">test</span><span class="o">)</span>
</code></pre>
</div>
<p>Or by setting the environment variable <code>BUILDR_ENV</code>:</p>
<div class="highlight"><pre><code class="text">$ export BUILDR_ENV=production
$ buildr
(in /home/john/project, production)
</code></pre>
</div>
<p>Unless you tell it otherwise, Buildr assumes you&#8217;re developing and sets the environment to <code>development</code>.</p>
<p>Here&#8217;s a simple example for handling different environments within the Buildfile:</p>
<div class="highlight"><pre><code class="ruby"><span class="n">project</span> <span class="s1">&#39;db-module&#39;</span> <span class="k">do</span>
  <span class="n">db</span> <span class="o">=</span> <span class="p">(</span><span class="no">Buildr</span><span class="o">.</span><span class="n">environment</span> <span class="o">==</span> <span class="s1">&#39;production&#39;</span> <span class="p">?</span> <span class="s1">&#39;oracle&#39;</span> <span class="p">:</span> <span class="s1">&#39;hsql&#39;</span><span class="p">)</span>
  <span class="n">resources</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;src/main/</span><span class="si">#{</span><span class="n">db</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
<span class="k">end</span>
</code></pre>
</div>
<p>We recommend picking a convention for your different environments and following it across all your projects.  For example:</p>
<table>
	<tr>
		<th>Environment </th>
		<th>Use when &#8230; </th>
	</tr>
	<tr>
		<td> development   </td>
		<td> Developing on your machine. </td>
	</tr>
	<tr>
		<td> test          </td>
		<td> Running in test environment, continuous integration. </td>
	</tr>
	<tr>
		<td> production    </td>
		<td> Building for release/production. </td>
	</tr>
</table>
<h2 id="profiles">Profiles</h2>
<p>Different environments may require different configurations, some you will want to control with code, others you will want to specify in the profiles file.</p>
<p>The profiles file is a <span class="caps">YAML</span> file called <code>profiles.yaml</code> that you place in the same directory as the Buildfile.  We selected <span class="caps">YAML</span> because it&#8217;s easier to read and edit than <span class="caps">XML</span>.</p>
<p>For example, to support three different database configurations, we could write:</p>
<div class="highlight"><pre><code class="yaml"><span class="c1"># HSQL, don&#39;t bother storing to disk.</span>
<span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">hsql</span>
  <span class="l-Scalar-Plain">jdbc</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">hsqldb:mem:devdb</span>

<span class="c1"># Make sure we&#39;re not messing with bigstrong.</span>
<span class="l-Scalar-Plain">test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">oracle</span>
  <span class="l-Scalar-Plain">jdbc</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">oracle:thin:@localhost:1521:test</span>

<span class="c1"># The real deal.</span>
<span class="l-Scalar-Plain">production</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">oracle</span>
  <span class="l-Scalar-Plain">jdbc</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">oracle:thin:@bigstrong:1521:mighty</span>
</code></pre>
</div>
<p>Here&#8217;s a simple example for a buildfile that uses the profile information:</p>
<div class="highlight"><pre><code class="ruby"><span class="n">project</span> <span class="s1">&#39;db-module&#39;</span> <span class="k">do</span>
  <span class="c1"># Copy SQL files specific for the database we&#39;re using,</span>
  <span class="c1"># for example, everything under src/main/hsql.</span>
  <span class="n">resources</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;src/main/</span><span class="si">#{</span><span class="no">Buildr</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">profile</span><span class="o">[</span><span class="s1">&#39;db&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
  <span class="c1"># Set the JDBC URL in copied resource files (config.xml needs this).</span>
  <span class="n">resources</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">using</span> <span class="ss">:jdbc</span><span class="o">=&gt;</span><span class="no">Buildr</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">profile</span><span class="o">[</span><span class="s1">&#39;jdbc&#39;</span><span class="o">]</span>
<span class="k">end</span>
</code></pre>
</div>
<p>The <code>profile</code> method returns the current profile, selected based on the current <a href="#environments">environment</a>.  You can get a list of all profiles by calling <code>profiles</code>.</p>
<p>When you run the above example in <code>development</code>, the current profile will return the hash <code>{ 'db'=&gt;'hsql', 'jdbc'=&gt;'hsqldb:mem:devdb' }</code>.</p>
<p>We recommend following conventions and using the same environments in all your projects, but sometimes the profiles end up being the same, so here&#8217;s a trick you can use to keep your profiles <span class="caps">DRY</span>.</p>
<p><span class="caps">YAML</span> allows you to use anchors (<code>&amp;</code>), similar to ID attributes in <span class="caps">XML</span>, reference the anchored element (<code>*</code>) elsewhere, and merge one element into another (<code>&lt;&lt;</code>).  For example:</p>
<div class="highlight"><pre><code class="yaml"><span class="c1"># We&#39;ll reference this one as common.</span>
<span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span> <span class="nl">&amp;common</span>
  <span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">hsql</span>
  <span class="l-Scalar-Plain">jdbc</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">hsqldb:mem:devdb</span>
  <span class="l-Scalar-Plain">resources</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">copyright</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Me (C) 2008</span>
<span class="c1"># Merge the values from common, override JDBC URL.</span>
<span class="l-Scalar-Plain">test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">&lt;&lt;</span><span class="p-Indicator">:</span> <span class="nv">*common</span>
  <span class="l-Scalar-Plain">jdbc</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">hsqldb:file:testdb</span>
</code></pre>
</div>
<p>You can <a href="http://www.yaml.org">learn more about <span class="caps">YAML</span> here</a>, and use this handy <a href="http://www.yaml.org/refcard.html"><span class="caps">YAML</span> quick reference</a>.</p>
      </div>
      <div id='footer'>Copyright &copy; 2007-2010 The Apache Software Foundation</div>
    </div>
  </body>
</html>
